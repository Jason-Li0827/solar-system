<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!--<script src="https://s2js.com/ojars/FunkcijasSkolai.js"></script>-->
    <style>
        body {
            margin: auto;
            display: flex;
            justify-content: center;
            /*background-color: pink;*/
        }
        
        .sideElements {
            margin: auto;
            display: grid;
            justify-content: center;
        }
        
        #changeDelay {
            margin: auto;
            display: block;
            justify-content: center;
        }
    </style>
</head>

<body>
    <canvas id=myCanvas width=1500 height=1500 style="background-color: pink;"> </canvas>

    <p class="sideElements" id="changeDelay">Change the delay!</p>
    <input type="text" id="delay" class="sideElements" value=100>
    <button onclick="submit()" class="sideElements">Enter</button>
    <script>
        //changeable variables
        var midX = 750; //centert of solor system
        var midY = 750;
        var delay = document.getElementById("delay").value; //the delay of setTimeOut
        //get canvas
        var ctx = myCanvas.getContext("2d");

        //get images
        var sun = new Image();
        sun.src = "sun.png";

        var mercury = new Image();
        mercury.src = "mercury.png";

        var venus = new Image();
        venus.src = "venus.png";

        var earth = new Image();
        earth.src = "earth.png";

        var mars = new Image();
        mars.src = "mars.png";

        var jupiter = new Image();
        jupiter.src = "jupiter.png";

        var saturn = new Image();
        saturn.src = "saturn.png";

        var uranus = new Image();
        uranus.src = "uranus.png";

        var neptune = new Image();
        neptune.src = "neptune.png";
        gaidaAtteluIeladi(done, sun, mercury, venus, earth, mars, jupiter, saturn, uranus, neptune);

        //setting variables
        var mercuryLoc = venusLoc = earthLoc = marsLoc = jupiterLoc = saturnLoc = uranusLoc = neptuneLoc = 0; //radians of angles
        //size of planets
        var planetR = {
            "sun": 80,
            "mercury": 36,
            "venus": 36,
            "earth": 48,
            "mars": 48,
            "jupiter": 96,
            "saturn": 96,
            "uranus": 72,
            "neptune": 72
        };
        //the distance between planet and the sun
        var planetD = {
            "mercury": 70,
            "venus": 120,
            "earth": 215,
            "mars": 300,
            "jupiter": 400,
            "saturn": 500,
            "uranus": 600,
            "neptune": 700
        };
        //the speed of each planet
        var planetS = {
            "mercury": 1,
            "venus": 1 / 2.5,
            "earth": 1 / 4.1,
            "mars": 1 / 7.8,
            "jupiter": 1 / 49,
            "saturn": 1 / 119,
            "uranus": 1 / 347,
            "neptune": 1 / 679.55
        };

        //basically does nothing
        //but gives a console log when all images all loaded
        function done() {
            console.log("Images loaded!")
        }

        function submit() {
            delay = document.getElementById("delay").value;
        }
        //calculate the middle of planet
        function getMid(imgName, x, y) {
            var width = planetR[imgName];
            //console.log(width);
            var midP = {
                "x": x - 1 / 2 * width,
                "y": y - 1 / 2 * width
            };
            return midP;
        }

        //draws the sun
        function drawSun() {
            var middle = getMid("sun", midX, midY);
            ctx.drawImage(sun, middle["x"], middle["y"]);
        }

        //draws the planets
        function planets(planetImg, planetName, i) {
            //get the distance between planet and sun(midpoint)
            var r = planetD[planetName];
            //get the speed of revolutionary period
            var s = planetS[planetName];
            //The planet's orbit
            pointAngleInRadians = i;
            var x = Math.cos(pointAngleInRadians) * r + midX;
            var y = Math.sin(pointAngleInRadians) * r + midY;
            //get the midponi coordinate andn draw the planet
            var middle = getMid(planetName, x, y);
            ctx.drawImage(planetImg, middle["x"], middle["y"]);

            i += s * 1 / 8 * Math.PI;

            if (i >= 2 * Math.PI) {
                i -= 2 * Math.PI;
                //console.log(i);
            }
            return i;

        }

        //combines everything together
        function solarSystem() {
            //clear canvas for redrawing
            const ctx = myCanvas.getContext('2d');
            ctx.clearRect(0, 0, myCanvas.width, myCanvas.height);
            //draws the solar system
            drawSun();
            mercuryLoc = planets(mercury, "mercury", mercuryLoc);
            venusLoc = planets(venus, "venus", venusLoc);
            earthLoc = planets(earth, "earth", earthLoc);
            marsLoc = planets(mars, "mars", marsLoc);
            jupiterLoc = planets(jupiter, "jupiter", jupiterLoc);
            saturnLoc = planets(saturn, "saturn", saturnLoc);
            uranusLoc = planets(uranus, "uranus", uranusLoc);
            neptuneLoc = planets(neptune, "neptune", neptuneLoc);
            setTimeout(solarSystem, delay);
        }

        solarSystem();



        // Skolotāja funkcija attēlu gaidīšanai
        // Funkcijai gaida, kad norādītie attēli ir ielādējušies no tīkla un tad izsauc pirmajā parametrā norādīto funkciju.
        // Gaidīšanas laikā lapas apakšā (pēc visiem elementiem) uzrādās "Attēlu ielāde ...", kas pazūd brīdī, kad visi attēli ir ielādēti.
        // Autors:: 2018-2019 Ojārs Krūmiņš
        // Versija 1.3
        function gaidaAtteluIeladi() {
            var images = [].slice.call(arguments);
            var num = arguments.length;
            var l = document.createElement('div');
            l.id = "loading_div";
            l.innerHTML = "Attēlu ielāde ";
            document.body.appendChild(l);
            var lcount = 1;
            var interval = setInterval(function() {
                var n = 1;
                for (var i = 1; i < images.length; i++) {
                    if (images[i].complete) {
                        n++;
                    }
                }
                if (n == num) {
                    clearInterval(interval);
                    document.getElementById("loading_div").remove();
                    images[0]();
                }
                lcount = (lcount + 1) % 50 + 1;
                l.innerHTML = "Attēlu ielāde " + ".".repeat(lcount / 10);
            }, 10);
        }
    </script>

</body>

</html>